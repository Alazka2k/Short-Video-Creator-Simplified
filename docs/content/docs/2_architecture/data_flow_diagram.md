---
title: "System Architecture and Data Flow"
linkTitle: "Architecture"
weight: 2
description: >
  A comprehensive overview of the SHORT-VIDEO-CREATOR-SIMPLIFIED system architecture and data flow.
---

## Overview

This document provides a detailed look at the current architecture of the SHORT-VIDEO-CREATOR-SIMPLIFIED system, including implemented services, planned improvements, and future developments.

## System Architecture Diagram

The following diagram illustrates the data flow and components of our system:

{{< mermaid >}}
graph TD
    A[Client] -->|HTTP Request| B(API Gateway :3000)
    B -->|/api/llm/generate| C[LLM Service :3001]
    B -->|/api/image/generate| D[Image Service :3002]
    B -->|/api/voice/generate| E[Voice Service :3003]
    B -->|/api/animation/generate| F[Animation Service :3004]
    B -->|/api/music/generate| G[Music Service :3005]
    B -->|/api/video/generate| H[Video Service :3006]
    B -->|/api/auth| I[Auth Service :3007]
    B -->|/api/job| J[Job Service :3008]
    B -->|/api/billing| K[Billing Service :3009]
    
    C -->|Response| B
    D -->|Response| B
    E -->|Response| B
    F -->|Response| B
    G -->|Response| B
    H -->|Response| B
    I -->|Response| B
    J -->|Response| B
    K -->|Response| B
    
    B -->|HTTP Response| A

    subgraph API Gateway
        L[Express.js Server]
        M[Axios HTTP Client]
    end

    subgraph "Core Services"
        C
        D
        E
        F
        G
        H
    end

    subgraph "Support Services"
        I
        J
        K
    end

    L -->|Forward Request| M
    M -->|Direct HTTP Request| C
    M -->|Direct HTTP Request| D
    M -->|Direct HTTP Request| E
    M -->|Direct HTTP Request| F
    M -->|Direct HTTP Request| G
    M -->|Direct HTTP Request| H
    M -->|Direct HTTP Request| I
    M -->|Direct HTTP Request| J
    M -->|Direct HTTP Request| K

    N[(Database)]
    O[External File Storage]

    C -->|Read/Write| N
    D -.->|Future Read/Write| N
    E -.->|Future Read/Write| N
    F -.->|Future Read/Write| N
    G -.->|Future Read/Write| N
    H -.->|Future Read/Write| N
    I -.->|Future Read/Write| N
    J -.->|Future Read/Write| N
    K -.->|Future Read/Write| N

    D -.->|Future File Storage| O
    E -.->|Future File Storage| O
    F -.->|Future File Storage| O
    G -.->|Future File Storage| O
    H -.->|Future File Storage| O

    classDef implemented fill:#90EE90,stroke:#333,stroke-width:2px;
    classDef implementedEndpoint fill:#FFFF00,stroke:#333,stroke-width:2px;
    classDef planned fill:#FFB6C1,stroke:#333,stroke-width:2px;
    
    class C implemented;
    class D,E,F,G,H implementedEndpoint;
    class I,J,K,O planned;
    class N implemented;
{{< /mermaid >}}

## Component Descriptions

### Client
- External application or user interface that sends requests to our system.

### API Gateway (Port 3000)
- Central entry point for all client requests.
- Implemented using Express.js for handling incoming HTTP requests.
- Uses Axios to forward requests directly to the appropriate service.

### Core Services

#### LLM Service (Port 3001)
- **Status: Fully Implemented (including database integration)**
- Handles language model processing tasks.
- Generates video scripts and scene descriptions.
- Stores data directly in the database.

#### Image Service (Port 3002)
- **Status: Implemented (endpoint only)**
- Responsible for image generation based on scene descriptions.
- Currently stores metadata and files locally.

#### Voice Service (Port 3003)
- **Status: Implemented (endpoint only)**
- Manages voice generation tasks for narration.
- Currently stores metadata and audio files locally.

#### Animation Service (Port 3004)
- **Status: Implemented (endpoint only)**
- Handles creation of animations from static images.
- Currently stores metadata and animation files locally.

#### Music Service (Port 3005)
- **Status: Implemented (endpoint only)**
- Generates background music for video content.
- Currently stores metadata and music files locally.

#### Video Service (Port 3006)
- **Status: Implemented (endpoint only)**
- Responsible for video creation and processing.
- Currently stores metadata and video files locally.

### Support Services

#### Auth Service (Port 3007)
- **Status: Planned**
- Will handle authentication and authorization.

#### Job Service (Port 3008)
- **Status: Planned**
- Will manage and track content creation jobs.

#### Billing Service (Port 3009)
- **Status: Planned**
- Will handle payments and subscriptions.

### Database
- **Status: Implemented**
- PostgreSQL database storing all persistent data.
- Currently fully integrated with LLM Service.
- Includes tables for users, jobs, LLM inputs/outputs, and service-specific outputs.

### External File Storage
- **Status: Planned**
- Will store files generated by various services (images, audio, animations, music, videos).
- Will be integrated with the database to link files with corresponding jobs and scenes.

## Current Data Flow

1. The client sends an HTTP request to the API Gateway.
2. The API Gateway forwards the request to the appropriate service.
3. For the LLM Service:
   - Processes the request and interacts with the database.
   - Stores job, input, output, and scene data in the database.
4. For other services (Image, Voice, Animation, Music, Video):
   - Process the request and generate content.
   - Store metadata and files locally in the output directory.
5. The service sends a response back to the API Gateway.
6. The API Gateway forwards the response back to the client.

## Planned Improvements

1. Database Integration for All Services:
   - Implement database operations for Image, Voice, Animation, Music, and Video services.
   - Store metadata and file references in respective database tables.

2. External File Storage System:
   - Set up a centralized file storage system (e.g., AWS S3, Google Cloud Storage).
   - Modify services to upload generated files to the external storage.
   - Update database schemas to store file references (URLs or paths) instead of local paths.

3. File-to-Database Linking:
   - Implement a system to link stored files with corresponding database records.
   - For job-level files (e.g., music), link directly to the job ID.
   - For scene-specific files (e.g., voice, images), link to both job ID and scene ID.

4. Service-Specific Improvements:
   - Image Service: Store image metadata and URLs in the `image_outputs` table.
   - Voice Service: Store voice metadata and URLs in the `voice_outputs` table, linked to scenes.
   - Animation Service: Store animation metadata and URLs in the `animation_outputs` table, linked to scenes.
   - Music Service: Store music metadata and URLs in the `music_outputs` table, linked to jobs.
   - Video Service: Store video metadata and URLs in the `video_outputs` table, linked to scenes.

## Next Steps

1. Implement database integration for all services, starting with Image and Voice services.
2. Set up the external file storage system and integrate it with the services.
3. Update database schemas to accommodate file storage references.
4. Modify services to use the new database and file storage system.
5. Implement comprehensive error handling and logging for the new integrations.
6. Develop and implement the planned support services (Auth, Job, Billing).
7. Create admin interfaces for monitoring job statuses and system health.
8. Develop comprehensive testing suites for all services, including integration tests with the new storage system.
9. Implement monitoring and alerting solutions for the entire system, including file storage.
10. Optimize database queries and implement caching where appropriate to improve performance.
11. Develop a strategy for scaling services and file storage as demand increases.

This updated architecture provides a clear path for improving the system's data persistence and file management while maintaining the modular approach to content generation.